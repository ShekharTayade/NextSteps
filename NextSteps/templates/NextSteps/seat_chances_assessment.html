
<!-- READ THE INSTRUCTIONS BELOW BEFORE USING THIS TEMPLATE
 1. Start your page with this template and modify. Rename this template with HTML name and then modify.
 2. We keep as it is the header portion of the page (which is top hidden block and the navigation) 
    and the footer portion (footer block) on each page.
 3. Override only the "slide-show", "features", and "jointhem-blog" blocks on each page
 4. Keep the top "hidden" clock and the nav-bar as it is, which forms the header section of the page.
 5. Overriding the parent blocks will start from "slide-show" block 
 6. Keep the <div>s  given below as it is in the "slide-show" and "features" blocks to keep the same styling matching the home page. 
    If overriding the parent block without any content then remove the <div>s too, just keep block and endblock. 
 7. For most of the pages, you can keep the title of the page in "slide-show" block and put all the content in "features" block. 
    The "jointhem-blog" block can be kept empty.
 8. PLEASE REMEBER :- 
    TO OVERRIDE A BLOCK USE THE CORRESPONDING BLOCK AND <div>s, 
    TO KEEP THE BLOCK EMPTY JUST USE THE BLOCK OPEN AND ENDBLOCK, 
    AND TO KEEP ABLOCK AS IT IS DON'T USE THE BLOCK NAMES HERE SO THOSE BLOCKS FROM PARENT WILL BE USED AS IT IS. 
 -->

<!-- Extend the home page to keep the same styling for header and footer sections. -->
{% extends 'NextSteps/NextSteps_base_vj.html' %}


<!-- Override slide-show block from parent -->
{% block slide-show %}
{% endblock slide-show %}

<!-- Override block from parent -->
{% block instt-prog-menu %}
{% endblock instt-prog-menu %}



<!-- Override features block -->
{% block features %}
    <!--<div class="showcase block block-border-bottom-grey"> -->
    <div class="block" style="padding-top: 5%; padding-bottom: 5%; ">
        <div class="container">

            <div class ="row">
                <h3 class="block-title pull-left">Assess Seat Chances - If, Then Analysis</h3>
                <small class = "pull-right">This page is best viewed on large screens, such as laptops, tablets.</small>
            </div>
    
            <div class="row">

                <form action="{% url 'if_then_analysis_results' %}" method='post' id='getAnalysis'>
                    {% csrf_token %}
                    <div id = "radio1" class = "row">
                        <div class = "col-sm-12">
                            <div class = "pull-left">
                                Would you like to use the Institution and Program preferences set by you?<small class = "text-muted">&nbsp;Seat probability will be assessed in these Institutions and Programs.</small>
                            </div>
                            <div id="prefRadio" class="pull-right" style = "border-bottom:2px solid Gainsboro;">
                                <label class="radio-inline">
                                    <input type="radio" id="radioyes" checked="checked" onchange = "setProgInsttList(), $('#mainRadio').click()" name="use_prefRadio" value="ON">Yes
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" id = "radiono" onchange = "setProgInsttList(), $('#mainRadio').click()" name="use_prefRadio"  value="OFF">No
                                </label>
                            </div>
                        </div>
                    </div>
    
                    <br />
                    <div id = "radio2" class = "row">
                        <div class = "col-sm-12">
                        <div class="pull-left">
                            Would you like to choose any Institutions and Programs for seat chance assessment?<small class = "text-muted">&nbsp;If not, all institutes, programs will be used.</small>
                        </div>
                        <div class = "pull-right" style = "border-bottom:2px solid Gainsboro;">
                            <label class="radio-inline">
                              <input type="radio" id="radioyes1"  checked="checked"  onchange = "setProgInsttList()" name="chooseProgsInstts"  value="ON">Yes
                            </label>
                            <label class="radio-inline">
                              <input type="radio" id = "radiono1" onchange = "setProgInsttList()" name="chooseProgsInstts"  value="OFF">No
                            </label>
                        </div>
                        </div>
                    </div>
    
                    <br />
                    <div class = "row">
                        <div class="col-sm-12">
                            <div class = "pull-left">                
                                Get the results by
                            </div>
                            
                            <div class = "pull-right"  style = "border-bottom:2px solid Gainsboro;">                
                                <div id= "mainAdvRadio">
                                    <label class="radio-inline">
                                      <input type="radio" id="mainRadio"  checked="checked"  onchange = "setMainAdv('MAIN')" name="mainAdvRadio"  value="MAIN">JEE(Main)
                                    </label>
                                    <label class="radio-inline">
                                      <input type="radio" id = "advRadio" onchange = "setMainAdv('ADV')" name="mainAdvRadio"  value="ADV">JEE(Adv)
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
    
                    <br />
                    <div class = "row">
                        <div class="col-sm-12">
                            <!-- <div class = "clearfix"> -->
                                <!-- <div class = "pull-right"> -->
                                    <div id="homestateList" class = "form-inline">                
                                        Select your Home State
                                        <select style= "border-top:none; border-left:none; border-right:none;" id="homestate" class = "form-control" name="homestate">
                                            {% for s in stateList %}
                                                <option>{{ s.Institute__state }}</option>
                                            {% endfor %}
                                        </select>                        
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                        Expected rank between
                                        <input id="from1" style = "border-top:none; border-left:none; border-right:none; background-color:#ffffff; border-bottom: 2 px solid Gainsboro;" required pattern="[0-9]{1,6}" name="rankFrom" class="qty-input form-control" max = "100000" min="1" maxlength="6" value="1000"/>
                                        and
                                        <input id="to1"  style = "border-top:none; border-left:none; border-right:none; background-color:#ffffff; border-bottom:2 px solid Gainsboro;" required pattern="[0-9]{1,6}"  name="rankTo" class="qty-input form-control" max = "100000" min="1" maxlength="6" value="2500"/>
                                    </div>
                                <!--</div>-->
                            <!--</div>-->
                        </div>
                    </div>
                    
                    <br />
                    <div class = "row">
                        <div class="col-sm-12">
                            <div id="stu_cat" class = "form-inline">
                                {% if stuCategory %}
                                    {% if validStuCat %}
                                        Your Student Category is "{{stuCategory}}".
                                        <input style = "display: none; border-top:none; border-left:none; border-right:none; background-color:#ffffff; border-bottom: 2 px solid Gainsboro;" class="stu_cat form-control" name = "stuCategory" value="{{stuCategory}}"/>
                                        &nbsp;
                                        Want to use a different one? Please select from:&nbsp;
                                    {% else %}
                                        Your Student Category "{{stuCategory}}" is not used by NTA any more. Please select from:&nbsp; 
                                    {% endif %}
                                {% else %}
                                    Please select your student category: &nbsp;
                                {% endif %}
                                <select id = "cat-select" class="form-control selectpicker" data-container= 'body' data-width="275px" multiple data-live-search="true" style= "border-top:none; border-left:none; border-right:none;" name="stuCatSelect">
                                    {% for s in stuCatList %}
                                        <option>{{ s.category }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <br />


                    
                    <div id = "prefDiv">
                        <div class = "row">
                            <div class = "col-sm-6" style = "padding-right:5px !important;">
                                <div class = "row">
                                <div class = "col-sm-11" style = "padding-right:5px !important;">
                                    <div class = "pref-head">
                                        Programs
                                    </div>
                                    <div id = "progDiv"  style = "height:260px; overflow: auto; background-color:#ffffff; box-shadow: 10px 10px 5px gainsboro;">
                                        {% if progList.count > 0 %}
                                            <table id="progTbl" class="display table table-striped table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for p in progList %}
                                                    <tr ondblclick = "$(this).addClass('selected'); moveToPrefProgs($(this).closest('tr').find('td:eq(0)').text());">
                                                        <td class="prog-row"> {{ p.Program__description }} </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        
                                        {% endif %}                            
                                    </div>
                                </div>    
                                <div class = "col-sm-1">
                                    <span style = "vertical-align:middle; " onclick = "moveToPrefProgs('')"> <i class = "fa fa-chevron-circle-right fa-2x"></i></span>
                                </div>
                                </div>
                            </div>
                            <div class = "col-sm-6" style = "overflow: auto;">
                                <div class = "pref-head">
                                    Your Selections
                                </div> 
                                <div  id = "prefProgs" style = "height:255px; overflow: auto; background-color:#ffffff;  box-shadow: 10px 10px 5px gainsboro;">
                                    <!-- <span style = "line-height:2.5; white-space:pre;" class = "global-filter">{{s.Program__description}}<i class="fa fa-close btn-inverse" onclick="removeProg( $(this).closest('span').text() ); $(this).closest('span').remove(); programChange()"></i></span>&emsp; -->
                                </div>
                            </div>
                        </div>    
        
                        <br />
                        <div class = "row">
                            <div class = "col-sm-6" style = "padding-right:5px !important;">
                                <div class="row">
                                <div class = "col-sm-11" style = "padding-right:5px !important;">
                                    <div class = "pref-head">
                                        Institutes
                                    </div> 
                                    <div id="insttDiv" style = "height:260px; overflow: auto; background-color:#ffffff; box-shadow: 10px 10px 5px gainsboro;">
                                        {% if insttList.count > 0 %}
                                            <table id="insttTbl" class="display table table-striped table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for i in insttList %}
                                                        <tr ondblclick = "$(this).addClass('selected'); moveToPrefInstts($(this).closest('tr').find('td:eq(0)').text());">
                                                            <td class="instt-row"> {{ i.Institute__instt_name }} </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div id = "chevron" class = "col-sm-1">
                                    <span style = "vertical-align:middle; " onclick = "moveToPrefInstts('')"> <i class = "fa fa-chevron-circle-right fa-2x"></i></span>
                                </div>
                                </div>
                            </div>
        
                            <div class = "col-sm-6">
                                <div class = "pref-head">
                                    Your Selections
                                </div>
                                <div id = "prefInstts" style = "height:255px; overflow: auto; background-color:#ffffff; box-shadow: 10px 10px 5px gainsboro;">
                                    <!-- <span style = "line-height:2.5; white-space:pre;" class = "global-filter">{{s.Institute__instt_name}}<i class="fa fa-close btn-inverse" onclick="removeProg( $(this).closest('span').text() ); $(this).closest('span').remove(); programChange()"></i></span>&emsp; -->
                                </div>
                            </div> 
                        </div>
                    </div>


                
                    
                    
                    
                    
                    
                    
                    <!------------- USER PREFERRED PROGS AND INSTTS SECTION ------------------>                    
                    <div id = "userPrefDiv">
                        <div class = "row"  >
                            <div class = "col-sm-6" style = "padding-right:5px !important;">
                                <div class = "row">
                                <div class = "col-sm-11" style = "padding-right:5px !important;">
                                    <div class = "pref-head">
                                        Programs
                                    </div> 
                                    <div id = "progUserDiv"  style = "height:260px; overflow: auto; background-color:#ffffff; box-shadow: 10px 10px 5px gainsboro;">
            <!--                            Search<input type="text" class = "form-control" id="progSearch"> -->
                                        {% if programUserList.count > 0 %}
                                            <table id="progUserTbl" class="display table table-striped table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for p in programUserList %}
                                                    <tr ondblclick = "$(this).addClass('selected'); moveToPrefProgs($(this).closest('tr').find('td:eq(0)').text());">
                                                        <td class="prog-row"> {{ p.Program__description }} </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        
                                        {% endif %}                            
                                    </div>
                                </div>    
                                <div class = "col-sm-1">
                                    <span style = "vertical-align:middle; " onclick = "moveToPrefProgs('')"> <i class = "fa fa-chevron-circle-right fa-2x"></i></span>
                                </div>
                                </div>
                            </div>
                            <div class = "col-sm-6" style = "overflow: auto;">
                                <div class = "pref-head">
                                    Your Selections
                                </div> 
                                <div id = "prefUserProgs" style = "height:255px; overflow: auto; background-color:#ffffff;  box-shadow: 10px 10px 5px gainsboro;">
                                    {% if programUserList %}
                                        {% for s in programUserList %}
                                            <span style = "line-height:2.5; white-space:pre;" class = "global-filter">{{s.Program__description}}<i class="fa fa-close btn-inverse" onclick="removeProgUser( $(this).closest('span').text() ); $(this).closest('span').remove()"></i></span>&emsp;
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>    
        
                        <br />
                        <div class = "row">
                            <div class = "col-sm-6" style = "padding-right:5px !important;">
                                <div class="row">
                                <div class = "col-sm-11" style = "padding-right:5px !important;">
                                    <div class = "pref-head">
                                        Institutes
                                    </div> 
                                    <div id="insttUserDiv" style = "height:260px; overflow: auto; background-color:#ffffff; box-shadow: 10px 10px 5px gainsboro;">
                                        {% if insttUserList.count > 0 %}
                                            <table id="insttUserTbl" class="display table table-striped table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for i in insttUserList %}
                                                        <tr ondblclick = "$(this).addClass('selected'); moveToPrefInstts($(this).closest('tr').find('td:eq(0)').text());">
                                                            <td class="instt-row"> {{ i.Institute__instt_name }} </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div id = "userchevron" class = "col-sm-1">
                                    <span style = "vertical-align:middle; " onclick = "moveToPrefInstts('')"> <i class = "fa fa-chevron-circle-right fa-2x"></i></span>
                                </div>
                                </div>
                            </div>
        
                            <div class = "col-sm-6">
                                <div class = "pref-head">
                                    Your Selections
                                </div>
                                <div id = "prefUserInstts" style = "height:255px; overflow: auto; background-color:#ffffff; box-shadow: 10px 10px 5px gainsboro;">
                                    {% if insttUserList %}
                                        {% for s in insttUserList %}
                                            <span style = "line-height:2.5; white-space:pre;" class = "global-filter">{{s.Institute__instt_name}}<i class="fa fa-close btn-inverse" onclick="removeInsttUser( $(this).closest('span').text() ); $(this).closest('span').remove()"></i></span>&emsp;
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div> 
                        </div>
                    </div>

                    <br>
                    <div class = "row">
                        <div class = "col-sm-12">
                        <div class = "center-block">
                            <button id = "submitbutton" name = "submitbutton" class='btn btn-more' type='submit' formmethod='post' value='submit' form = 'getAnalysis'> <i class="fa fa-caret-right"></i> Analyze</button>
                        </div>
                        </div>
                    </div>


                    <!-- Used to be able to submit the selected programs and institutes along with the other values in the form. -->
                    <div style = "display:none;" class = "nv_div">
                        <select id = "prefPrograms_nv" multiple='multiple' name="progList" size='10'>
                        </select>
                        <select id = "prefInstitutes_nv" multiple='multiple' name="insttList" size='10'>
                        </select>
                    </div>
                    
                    <!-- Preferred Student Category -->
                    <input hidden name = "stuCategory" value = "{{stuCategory}}" />  
                </form>

            </div>
        </div>
    </div>
    
    <script>
    
    var progTable; 
    var progUserTable
    var insttTable;
    var insttUserTable;
    var selectedProgs = [];
    var selectedUserProgs = [];
    var selectedInstts = [];
    var selectedUserInstts = [];
    
    $(document).ready(function() {
        progTable = $('#progTbl').DataTable( {
        retrieve: true,
        "columns": [{
            "title": "",
            "data": "Program_id"
        }],         
        select: {
            style: 'multi'
        },
        paging: false
        } );


        insttTable = $('#insttTbl').DataTable( {
        retrieve: true,
        "columns": [{
            "title": "",
            "data": "Institute__instt_name"
        }],                 
        select: {
            style: 'multi'
        },
        paging: false
        } );


        progUserTable = $('#progUserTbl').DataTable( {
        retrieve: true,
        "columns": [{
            "title": "",
            "data": "Program_id"
        }],         
        select: {
            style: 'multi'
        },
        paging: false
        } );

        insttUserTable = $('#insttUserTbl').DataTable( {
        retrieve: true,
        "columns": [{
            "title": "",
            "data": "Institute__instt_name"
        }],                 
        select: {
            style: 'multi'
        },
        paging: false
        } );


    } );    
    </script>

    <script>
        $(document).ready(function () {
            $("#radiono").prop("checked", true);
            setProgInsttList();
            setMainAdv('MAIN');    
            
            $('#cat-select').selectpicker();
        });    
    </script>

    <script>
        function setMainAdv(choice){
        
            if (choice == 'MAIN') {
                document.getElementById("homestate").disabled = false;
            }
            if (choice == 'ADV') {
                document.getElementById("homestate").disabled  = true;
            }
        }
    </script>


    <script>
        function setProgInsttList(){
        
            RadioYes = document.getElementById("radioyes").checked
            RadioNo = document.getElementById("radiono").checked
            
            Radio1Yes = document.getElementById("radioyes1").checked
            Radio1No = document.getElementById("radiono1").checked
            
            if (RadioYes) {
                document.getElementById("prefDiv").style.display= "none"
                document.getElementById("userPrefDiv").style.display= "block"

                document.getElementById("radio2").style.display = "none";
            } else {
                
                if (RadioNo && Radio1Yes) {
                    document.getElementById("prefDiv").style.display= "block"
                    document.getElementById("userPrefDiv").style.display= "none"
    
                    document.getElementById("radio2").style.display = "block";
    
                } else {
                    if (Radio1No) {
                        document.getElementById("prefDiv").style.display = "none"; 
                        document.getElementById("userPrefDiv").style.display= "none"
                        
                        document.getElementById("radio2").style.display = "block";
                       }
                }
            }
        }
    </script>


    <script>    
        function getSelectedProgs(){
            rows = progTable.rows( { selected: true } ).data();        
            for (var i=0; i < rows.length ;i++){
                selectedProgs.push(rows[i].Program_id);
            }
        }
 
       function getSelectedInstts(){
            rows = insttTable.rows( { selected: true } ).data();        
            for (var i=0; i < rows.length ;i++){
                selectedInstts.push(rows[i].Institute__instt_name);
            }
        }
  
        function getSelectedUserProgs(){
            rows = progUserTable.rows( { selected: true } ).data();        
            for (var i=0; i < rows.length ;i++){
                selectedUserProgs.push(rows[i].Program_id);
            }
        }
 
       function getSelectedUserInstts(){
            rows = insttUserTable.rows( { selected: true } ).data();        
            for (var i=0; i < rows.length ;i++){
                selectedUserInstts.push(rows[i].Institute__instt_name);
            }
        }
  
    </script>

    <script>
        function moveToPrefProgs(prog) {

            // Get the selected programs in the global array "selectedProgs"
            getSelectedProgs();
            getSelectedUserProgs();
 
 
            // Get the programs already present in preferred programs DIV
            var prog_arr = [];
            var prog_user_arr = [];
            $("#prefProgs span").each(function(index, elem){
                prog_arr.push( $(this).text().trim() );
            }); 
            $("#prefUserProgs span").each(function(index, elem){
                prog_user_arr.push( $(this).text().trim() );
            }); 
            
            // 'prog' input parameter is blank when the chevron is used to move to preferred programs.
            if (prog === '') {
                for (var i = 0; i< selectedProgs.length; i++ ) {

                    prognm = selectedProgs[i].trim().replace(/&amp;/g, '&');
                    
                    // Check if the program is already present in the preferred programs DIV
                    var found = false;
                    for (j=0; j < prog_arr.length; j++) {
                        if ( prog_arr[j].toLowerCase().trim() === prognm.toLowerCase().trim() ) {
                        found = true;
                        }
                    }    
                    if (found == false ) {
                        $("#prefProgs").append('<span style = "line-height:2.5; white-space:pre;" class = "global-filter">' + prognm + '<i class="fa fa-close btn-inverse" onclick="$(this).closest(\'span\').remove(); removeProg($(this).closest(\'span\').text())"></i></span>&emsp;');    
                    }
                }

                for (var i = 0; i< selectedUserProgs.length; i++ ) {

                    prognm = selectedUserProgs[i].trim().replace(/&amp;/g, '&');
                    
                    // Check if the program is already present in the preferred programs DIV
                    var found = false;
                    for (j=0; j < prog_user_arr.length; j++) {
                        if ( prog_user_arr[j].toLowerCase().trim() === prognm.toLowerCase().trim() ) {
                        found = true;
                        }
                    }    
                    if (found == false ) {
                        $("#prefUserProgs").append('<span style = "line-height:2.5; white-space:pre;" class = "global-filter">' + prognm + '<i class="fa fa-close btn-inverse" onclick="$(this).closest(\'span\').remove(); removeProgUser($(this).closest(\'span\').text())"></i></span>&emsp;');    
                    }
                }

            } else {
                
                var found = false;
                for (var i = 0; i< prog_arr.length; i++ ) {
                    
                    // Get the selected programs in the global array "selectedProgs"
                    prefPrognm = prog_arr[i].trim().replace(/&amp;/g, '&');
                    if ( prog.toLowerCase().trim() === prefPrognm.toLowerCase().trim() ) {
                        found = true;
                    }

                }
                if (found == false ) {
                    $("#prefProgs").append('<span style = "line-height:2.5; white-space:pre;" class = "global-filter">' + prog + '<i class="fa fa-close btn-inverse" onclick=" $(this).closest(\'span\').remove(); removeProg($(this).closest(\'span\').text())"></i><\/span>&emsp;');
                }


                var found = false;
                for (var i = 0; i< prog_user_arr.length; i++ ) {
                    
                    // Get the selected programsin the global array "selectedUserProgs"
                    prefPrognm = prog_user_arr[i].trim().replace(/&amp;/g, '&');
                    if ( prog.toLowerCase().trim() === prefPrognm.toLowerCase().trim() ) {
                        found = true;
                    }

                }
                if (found == false ) {
                    $("#prefUserProgs").append('<span style = "line-height:2.5; white-space:pre;" class = "global-filter">' + prog + '<i class="fa fa-close btn-inverse" onclick=" $(this).closest(\'span\').remove(); removeProgUser($(this).closest(\'span\').text())"></i><\/span>&emsp;');
                }

            }
            
            // Empty the array
            selectedProgs=[];
            selectedUserProgs=[];

            //Remove moved rows from the table
            progTable.rows('.selected').remove().draw();
            progUserTable.rows('.selected').remove().draw();
            

            //Call "programChange" function to update insttitue list
            programChange();
        }


        function moveToPrefInstts(instt) {

            // Get the selected institutes in the global array "selectedInstts"
            getSelectedInstts();
            getSelectedUserInstts();

            // Get the institutes already present in preferred institutes DIV
            var instt_arr = [];
            var instt_user_arr = [];
            $("#prefInstts span").each(function(index, elem){
                instt_arr.push( $(this).text().trim() );
            }); 
            $("#prefUserInstts span").each(function(index, elem){
                instt_user_arr.push( $(this).text().trim() );
            }); 

             // 'instt' input parameter is blank when the chevron is used to move to preferred institutes.
            if (instt === '') {
                var len = selectedInstts.length;
                for (var i = 0; i< len; i++ ) {
                    insttnm = selectedInstts[i].trim().replace(/&amp;/g, '&');

                    // Check if the institutes is already present in the preferred institutes DIV
                    var found = false;
                    for (j=0; j < instt_arr.length; j++) {
                        if ( instt_arr[j].toLowerCase().trim() === insttnm.toLowerCase().trim() ) {
                        found = true;
                        }
                    }    
                    if (found == false ) {
                        $("#prefInstts").append('<span style = "line-height:2.5; white-space:pre;" class = "global-filter">' + insttnm + '<i class="fa fa-close btn-inverse" onclick="$(this).closest(\'span\').remove(); removeInstt($(this).closest(\'span\').text())"></i></span>&emsp;');    
                    }
                }
                
                var len = selectedUserInstts.length;
                for (var i = 0; i< len; i++ ) {
                    insttnm = selectedUserInstts[i].trim().replace(/&amp;/g, '&');

                    // Check if the institutes is already present in the preferred institutes DIV
                    var found = false;
                    for (j=0; j < instt_user_arr.length; j++) {
                        if ( instt_user_arr[j].toLowerCase().trim() === insttnm.toLowerCase().trim() ) {
                        found = true;
                        }
                    }    
                    if (found == false ) {
                        $("#prefUserInstts").append('<span style = "line-height:2.5; white-space:pre;" class = "global-filter">' + insttnm + '<i class="fa fa-close btn-inverse" onclick="$(this).closest(\'span\').remove(); removeInsttUser($(this).closest(\'span\').text())"></i></span>&emsp;');    
                    }
                }
                
            } else {

                var found = false;
                for (var i = 0; i< instt_arr.length; i++ ) {
                    prefInsttnm = instt_arr[i].trim().replace(/&amp;/g, '&');
                    if ( instt.toLowerCase().trim() === prefInsttnm.toLowerCase().trim() ) {
                        found = true;
                    }
                }

                if (found == false ) {
    
                    $("#prefInstts").append('<span style = "line-height:2.5; white-space:pre;" class = "global-filter">' + instt + '<i class="fa fa-close btn-inverse" onclick="$(this).closest(\'span\').remove(); removeInstt($(this).closest(\'span\').text())"></i></span>&emsp;');    
                }
                
                
                var found = false;
                for (var i = 0; i< instt_user_arr.length; i++ ) {
                    prefInsttnm = instt_user_arr[i].trim().replace(/&amp;/g, '&');
                    if ( instt.toLowerCase().trim() === prefInsttnm.toLowerCase().trim() ) {
                        found = true;
                    }
                }

                if (found == false ) {
    
                    $("#prefUserInstts").append('<span style = "line-height:2.5; white-space:pre;" class = "global-filter">' + instt + '<i class="fa fa-close btn-inverse" onclick="$(this).closest(\'span\').remove(); removeInsttUser($(this).closest(\'span\').text())"></i></span>&emsp;');    
                }
                
            }

            // Empty the array
            selectedInstts=[];
            selectedUserInstts=[];

            //Removed moved rows from the table
            insttTable.rows('.selected').remove().draw();
            insttUserTable.rows('.selected').remove().draw();
                
            //Call "instituteChange" function to update insttitue list
            instituteChange();
        }

    </script>


    <script>
        // On change in selected Programs, update the Institute table and preferred institutes
        function programChange(){
            //Get the preferred programs
            var prog_arr = [];
            var prog_user_arr = [];
            $("#prefProgs span").each(function(index, elem){
                prog_arr.push( $(this).text().trim() );
            }); 
            //$("#prefUserProgs span").each(function(index, elem){
            //    prog_user_arr.push( $(this).text().trim() );
            //}); 

            
            // Update the Institute list and pref institutes
            
            // Remove all rows from the table
            insttTable.rows().remove().draw();
            //insttUserTable.rows().remove().draw();
            
            var cntList= 'India';
            var discList= 'Engineering';
            var lvlList= 'Undergraduation';
     
            //$.ajax({
            //   url: '{% url "get_insttsForProgs" %}',
            //    data: {'cntList': cntList, 'discList' : discList, 'lvlList' : lvlList, 'progList[]' : prog_arr},
            //    dataType: 'json',
            //    success: function (data) {
            //        $.each(data, function(index, element) {
            //            insttTable.row.add([data[index].Institute__instt_name]).draw(false);
            //        });
            //    insttTable.draw(); 

            //   }
            //});

            $.ajax({
                url: '{% url "get_insttsForProgs" %}',
                data: {'cntList': cntList, 'discList' : discList, 'lvlList' : lvlList, 'progList[]' : prog_arr},
                dataType: 'json',
                success: function (data) {
                    insttTable.rows.add(data).draw();
                }
            });

        }          
        

        // On change in selected Programs, update the Institute table and preferred institutes
        function instituteChange(){

            //Get the preferred institutes
            var instt_arr = [];
            $("#prefInstts span").each(function(index, elem){
                instt_arr.push( $(this).text().trim() );
            }); 

            
            // Update the Institute list and pref institutes
            
            // Remove all rows from the table
            progTable.rows().remove().draw();
            
            var cntList= 'India';
            var discList= 'Engineering';
            var lvlList= 'Undergraduation';
     
            //$.ajax({
            //    url: '{% url "get_progsForInstts" %}',
            //    data: {'cntList': cntList, 'discList' : discList, 'lvlList' : lvlList, 'insttList[]' : instt_arr },
            //    dataType: 'json',
            //    success: function (data) {
            //        $.each(data, function(index, element) {
            //            progTable.row.add([data[index].Program_id]).draw(false);
            //        })
            //    progTable.draw(); 
                
            //    }
            //});

            $.ajax({
                url: '{% url "get_progsForInstts" %}',
                data: {'cntList': cntList, 'discList' : discList, 'lvlList' : lvlList, 'insttList[]' : instt_arr },
                dataType: 'json',
                success: function (data) {
                    progTable.rows.add(data).draw();
                }
            });

        }          
            

    </script>
    

    <script>
        // Add removed program from preferred to available programs
        function removeProg(txt) {

            if (txt != '' ){
                //Check if the program already exists in the avlProgTbl
                var cells = document.querySelectorAll("#progTbl td");
                var found = false;
                for(var i = 0; i < cells.length; ++i){
                    // This line checks for an exact match in a cell 
                    if(cells[i].textContent.toLowerCase().trim() === txt.toLowerCase().trim()){
                        found = true;
                    }
                }
                if (found == false) {
                    jsonObj = [];
                    item = [];
                    item ["Program_id"] = txt;
                    jsonObj.push(item);                
    
                    progTable.rows.add(jsonObj).draw();
                }
                
                programChange();
            }
        }

        function removeProgUser(txt) {

            if (txt != '' ){
                //Check if the program already exists in the avlProgTbl
                var cells = document.querySelectorAll("#progUserTbl td");
                var found = false;
                for(var i = 0; i < cells.length; ++i){
                    // This line checks for an exact match in a cell 
                    if(cells[i].textContent.toLowerCase().trim() === txt.toLowerCase().trim()){
                        found = true;
                    }
                }
                if (found == false) {
                    jsonObj = [];
                    item = [];
                    item ["Program_id"] = txt;
                    jsonObj.push(item);                
    
                    progUserTable.rows.add(jsonObj).draw();
                    //progUserTable.row.add([txt]).draw( false );
                }
            }
        }


        //Add removed institute from preferred to available institutes
        function removeInstt(txt) {

            if (txt != '' ){
                //Check if the institute already exists in the avlInsttTbl
                var cells = document.querySelectorAll("#insttTbl td");
                var found = false;
                for(var i = 0; i < cells.length; ++i){
                    // This line checks for an exact match in a cell 
                    if(cells[i].textContent.toLowerCase().trim() === txt.toLowerCase().trim()){
                        found = true;
                    }
                }
                if (found == false) {
                    jsonObj = [];
                    item = [];
                    item ["Institute__instt_name"] = txt;
                    jsonObj.push(item);                
    
                    insttTable.rows.add(jsonObj).draw();
                    //insttTable.row.add([txt]).draw( false );
                }

                instituteChange();

            }
        }

        function removeInsttUser(txt) {

            if (txt != '' ){
                //Check if the institute already exists in the avlInsttTbl
                var cells = document.querySelectorAll("#insttUserTbl td");
                var found = false;
                for(var i = 0; i < cells.length; ++i){
                    // This line checks for an exact match in a cell 
                    if(cells[i].textContent.toLowerCase().trim() === txt.toLowerCase().trim()){
                        found = true;
                    }
                }
                if (found == false) {
                    jsonObj = [];
                    item = [];
                    item ["Institute__instt_name"] = txt;
                    jsonObj.push(item);                
    
                    insttUserTable.rows.add(jsonObj).draw();
                    //insttUserTable.row.add([txt]).draw( false );
                }
            }
        }

    </script>


   <!-- To populate the non-visible selected programs and institutes before form is submitted-->
    <script>
        $(document).ready(function(){
            var insttcode= [];
            $("#getAnalysis").submit(function(){
                    
                // Get the programs present in selected programs DIVs
                var prog_arr = [];
                var prog_user_arr = [];
                $("#prefProgs span").each(function(index, elem){
                    prog_arr.push( $(this).text().trim() );
                }); 
                $("#prefUserProgs span").each(function(index, elem){
                    prog_user_arr.push( $(this).text().trim() );
                }); 
                
                // Get the institutes present in selected institutes DIVs
                var instt_arr = [];
                var instt_user_arr = [];
                $("#prefInstts span").each(function(index, elem){
                    instt_arr.push( $(this).text().trim() );
                }); 
                $("#prefUserInstts span").each(function(index, elem){
                    instt_user_arr.push( $(this).text().trim() );
                });      
                
                // Populate the non-visible SELECT boxes
                if ( $("input[type='radio'][name='use_prefRadio']:checked").val() == "ON" ) {

                    for (i = 0; i < prog_user_arr.length; i++) {
                        $('#prefPrograms_nv')
                            .append($("<option></option>")
                            .attr("value", prog_user_arr[i])
                            .text( prog_user_arr[i] )
                        );            
                        $("#prefPrograms_nv").val(prog_user_arr[i]);
                    }
                    //Select all options so all get submitted in the form
                    $('#prefPrograms_nv option').prop('selected', true);

                    for (i = 0; i < instt_user_arr.length; i++) {
                        $('#prefInstitutes_nv')
                            .append($("<option></option>")
                            .attr("value", instt_user_arr[i])
                            .text( instt_user_arr[i] )
                        );            
                        $("#prefInstitutes_nv").val(instt_user_arr[i]);
                    }
                    //Select all options so all get submitted in the form
                    $('#prefInstitutes_nv option').prop('selected', true);

                }
                

                if ( $("input[type='radio'][name='use_prefRadio']:checked").val() == "OFF" ) {

                    for (i = 0; i < prog_arr.length; i++) {
                        $('#prefPrograms_nv')
                            .append($("<option></option>")
                            .attr("value", prog_arr[i])
                            .text( prog_arr[i] )
                        );            
                        $("#prefPrograms_nv").val(prog_arr[i]);
                    }
                    //Select all options so all get submitted in the form
                    $('#prefPrograms_nv option').prop('selected', true);
                    
                    
                    for (i = 0; i < instt_arr.length; i++) {
                        $('#prefInstitutes_nv')
                            .append($("<option></option>")
                            .attr("value", instt_arr[i])
                            .text( instt_arr[i] )
                        );            
                        $("#prefInstitutes_nv").val(instt_arr[i]);
                    }
                    //Select all options so all get submitted in the form
                    $('#prefInstitutes_nv option').prop('selected', true);

                }
                
                // Warn user in case user is not using the preferences
                if ( $("input[type='radio'][name='use_prefRadio']:checked").val() == "OFF" ) {
                    if (prog_arr.length == 0 && instt_arr.length == 0) {
                        okcancel = confirm("You have not slected any Programs or Institutes. Analysis will consider all the Programs and Institutes. Are you OK to proceed?");
                        if (!okcancel) {
                            return false;
                        }
                    }
                }
            });
        });
    </script>


{% endblock features %}

{% block registration %}
{% endblock registration %}
<!-- Footer-section remains as it is, no override -->


